# MYSQL核心技术总结

------

>   Mysql主要分为 **Server** 层和 **存储引擎** 两大块

- **Server层**
    - *连接器*

    建立管理连接，长连接默认8小时，占用内存多的查询建议调用后使用mysql_reset_connection（Mysql为编程语言提供的API，不是Sql）重置连接，连接池可以把短连接变成长连接。**短连接和长连接不是通过参数设置的**，他们是一种“行为”，比如连接完，执行一个查询，就断开，这是短连接；执行一个查询，不断开，下次查询还用这个连接，持续使用，就是长链接，**使用的方式决定了连接的类型**。

    缓存功能，以执行SQL和结果组成key-vlaue，涉及的表有更新缓存便失效，不建议使用，8.0以后完全废除。
    可以将参数 query_cache_type 设置成 DEMAND，这样对于默认的 SQL 语句都不使用查询缓存，然后对于需要的SQL（比如**静态表**）可以主动指定：
    ```
      mysql> select SQL_CACHE * from T where ID=10；
    ```
    - *分析器*

    解析SQL语句，匹配表名和字段以及关键词（SELECT等）。
    - *优化器*

    在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序
    - *执行器*

    要先判断一下你对这个表 T 有没有执行查询的权限，如果没有，就会返回没有权限的错误。如果有权限，就打开表继续执行。打开表的时候，执行器就会根据表的引擎定义，去使用这个引擎提供的接口。

    如果用户名密码认证通过，连接器会到权限表里面查出你拥有的权限和执行阶段去查询有没有select的权限这两个有什么区别？

    连接器阶段是去系统表读数据，结果放在变量；执行器使用这个变量
- **存储引擎**

    存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。

    也就是说，你执行 create table 建表的时候，如果不指定引擎类型，默认使用的就是 InnoDB。不过，你也可以通过指定存储引擎的类型来选择别的引擎，比如在 create table 语句中使用 engine=memory, 来指定使用内存引擎创建表。不同存储引擎的表数据存取方式不同，支持的功能也不同。
