#### ES核心概念

![](../pic/es/es5.png)

![](../pic/es/es6.png)

> 倒排索引

**通俗地来讲，正向索引是通过key找value，反向索引则是通过value找key。**

倒排列表记录了出现过某个单词的所有文档的文档列表及单词在该文档中出现的位置信息，每条记录称为一个倒排项(Posting)。

根据倒排列表，即可获知哪些文档包含某个单词。（PS：实际的倒排列表中并不只是存了文档ID这么简单，还有一些其它的信息，比如：词频（Term出现的次数）、偏移量（offset）等，可以想象成是Python中的元组，或者Java中的对象）

![](../pic/es/es7.png)

> 分片是什么？

简单来讲就是咱们在ES中所有数据的文件块，也是数据的最小单元块，整个ES集群的核心就是对所有分片的分布、索引、负载、路由等达到惊人的速度

实列场景：

假设 IndexA 有2个分片，我们向 IndexA 中插入10条数据 (10个文档)，那么这10条数据会尽可能平均的分为5条存储在第一个分片，剩下的5条会存储在另一个分片中。

> 索引建立后，分片个数是不可以更改的,但可以随时调整replica数(number_of_replicas)

- 分片是独立的，对于一个Search Request的行为，每个分片都会执行这个Request。

- 每个分片都是一个Lucene Index，所以一个分片只能存放Integer.MAX_VALUE - 128 = 2,147,483,519 个docs.

- 复制，可以理解为备份分片，相应地有primary shard（主分片）。

- 主分片和备分片不会出现在同一个节点上（防止单点故障），默认情况下一个索引创建5个分片一个备份**即5primary+5replica=10个分片**）

- **如果你只有一个节点，那么5个replica都无法分配（unassigned），此时cluster status会变成Yellow**
